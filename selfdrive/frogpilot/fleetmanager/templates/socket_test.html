{% extends "layout.html" %}

{% block title %}
    Socket Test
{% endblock %}

{% block main %}
    <canvas id="radarCanvas" width="800" height="600"></canvas>
    <div id="radarStateInfo"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
    <script>
        const canvas = document.getElementById("radarCanvas");
        const ctx = canvas.getContext("2d");

        const carWidth = 20;
        const carHeight = 40;
        const leadVehicleSize = 30;

        const socket = io.connect('http://10.0.0.41:8082');
        const radarStateInfo = document.getElementById("radarStateInfo");

        socket.on('radarData', function (radarState) {
            // Log radarState to the browser console
            console.log('Received radarState:', radarState);

            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the driver's car at the bottom center
            const carX = (canvas.width - carWidth) / 2;
            const carY = canvas.height - carHeight;
            ctx.fillStyle = "blue";
            ctx.fillRect(carX, carY, carWidth, carHeight);

            // Draw lead vehicles
            drawLeadVehicle(radarState.leadOne, "red");
            drawLeadVehicle(radarState.leadTwo, "green");

            // Display radarState information on the screen
            radarStateInfo.innerHTML = `<pre>${JSON.stringify(radarState, null, 2)}</pre>`;
        });

        function drawLeadVehicle(leadData, color) {
            const leadX = canvas.width / 2 + leadData.yRel * 10; // Adjust multiplier as needed
            const leadY = canvas.height - leadData.dRel * 10; // Adjust multiplier as needed

            ctx.fillStyle = color;
            ctx.fillRect(leadX - leadVehicleSize / 2, leadY - leadVehicleSize / 2, leadVehicleSize, leadVehicleSize);
        }
    </script>
{% endblock %}
