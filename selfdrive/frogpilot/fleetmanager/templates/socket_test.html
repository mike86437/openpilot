{% extends "layout.html" %}

{% block title %}
  Socket Test
{% endblock %}

{% block main %}
  <canvas id="radarCanvas" width="644" height="318"></canvas>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
  <script>
    const canvas = document.getElementById("radarCanvas");
    const ctx = canvas.getContext("2d");

    const socket = io.connect('{{ server_ip }}');

// Load background image
const backgroundImage = new Image();
backgroundImage.src = "/static/background.png";

backgroundImage.onload = function() {
  // Set canvas size to match the background image
  canvas.width = backgroundImage.width;
  canvas.height = backgroundImage.height;

  // Draw the background image on the canvas
  ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
};

// Rest of your code...
socket.on('radarData', function (radarState) {
  // Clear the canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw the driver's car at the bottom center
  const carX = (canvas.width - carImage.width) / 2;
  const carY = canvas.height - carImage.height;

  // Draw other elements...

  // Draw lead vehicle (leadOne) in blue
  if (radarState.leadOne.dRel !== 0 && radarState.leadOne.dRel < maxDRel && Math.abs(radarState.leadOne.yRel) < maxYRel) {
    drawLeadVehicle(radarState.leadOne, "blue");
  }
});

function drawLeadVehicle(leadData, color) {
  // Skip drawing if dRel is equal to 0
  if (leadData.dRel === 0) {
    return;
  }

  const leadX = canvas.width / 2 + leadData.yRel * yRelScalingFactor - leadVehicleSize / 2;
  const leadY = canvas.height - leadData.dRel * dRelScalingFactor - leadVehicleSize / 2;

  ctx.drawImage(leadVehicleImage, leadX, leadY, leadVehicleSize, leadVehicleSize);
}
  </script>
  
{% endblock %}
